# Офікація рутини

Офікація рутини - перетворення рутини, котра очікує масив аргументів в таку рутину, яка очікує мапу опцій <code>о</code>.

<!-- qqq : визначення було неконетним. офікація це не процес! -->

Деякі функції очікують кількість аргументів більшу ніж розробникові комфортно вказувати. Якщо кількість аргументів 3 або більше то не важко заплутатися в тому, котрий аргумент йде за яким. Ситуація ще більше ускладнюється якщо деякі аргументи є опціональними й можуть вилучатися із виклику. Тому в таких ситуаціях є сенс використовувати [мапу опцій](../concept/RoutineInput.md#мапа-опцій) замість [масиву аргументів](../concept/RoutineInput.md#масив-аргументів).

**Переваги**

* Покращення читабельності коду за рахунок іменування елементів вхідних даних.
* Верифікація вхідних даних.
* Зручність виклику адже послідовність не має значення.
* Уніфікація коду - одна сутність на вході, одна на виході.
* Можливість поєднання: виклик зі списком аргументів й виклик із мапою опцій.

### Приклад офікації рутини

Для прикладу візьмемо рутину `mapToStr`.

```javascript
function mapToStr( src, keyValDelimeter, entryDelimeter)
{
  let result = '';
  for( let s in src )
  result += s + keyValDelimeter + src[ s ] + entryDelimeter;
  result = result.substr( 0, result.length-entryDelimeter.length );
  return result
}
```
Рутина `mapToStr` конвертує об'єкт `src` у рядок, розділяючи ключ та значення через `keyValDelimeter`, а пари ключ-значення через `entryDelimeter`.

**Аргументи:**

- `src` - вхідний об'єкт.
- `keyValDelimeter` - сепаратор між ключем і значенням.
- `entryDelimeter` - сепаратор між парами ключ-значення.

**Для офікації потрібно:**

- Створити єдиний параметр `o`.
- Додати мапу дефолтних опцій `mapToStr.defaults`.
- Додати виклик `_.routine.options( mapToStr, o );`.
- В тілі рутини працювати з параметрами через ключі `o`: `o.src` і т.д.

**Офікована рутина:**

Після офікації.

```javascript
function mapToStr( o )
{

  if( _.strIs( o ) )
  o = { src : o }
  _.routine.options( mapToStr, o );
  _.assert( arguments.length === 1, 'Expects single argument' );

  let result = '';
  for( let s in o.src )
  result += s + o.keyValDelimeter + o.src[ s ] + o.entryDelimeter;
  result = result.substr( 0, result.length-o.entryDelimeter.length );

  return result
}

mapToStr.defaults =
{
  src : null,
  keyValDelimeter : ':',
  entryDelimeter : ';',
}
```

Рутина `mapToStr` конвертує об'єкт `o.src` у рядок, розділяючи ключ та значення через `o.keyValDelimeter`, а пари ключ значення через `o.entryDelimeter`. Виклик до `_.routine.options` виконує перевірку вхідних значень.

**Аргументи:**

- `o` - мапа опцій, яка має 3 пари ключ-значення:
  - `src` - вхідний об'єкт.
  - `keyValDelimeter` - сепаратор між ключем і значенням.
  - `entryDelimeter` - сепаратор між парами ключ-значення.

Використовуючи мапу опцій, опцію можливо задавати в будь-якій послідовності і вилучати ті, які мають значення по замовчуванню.

Мапа дефолтних значень -  призначена для зберігання налаштувань за замовчуванням:

```javascript
mapToStr.defaults =
{
  src : null,
  keyValDelimeter : ':',
  entryDelimeter : ';',
}
```

При відсутності `keyValDelimeter` або `entryDelimeter` будуть застосовуватися дефолтні значення.

**Перевірка вхідних значень**

Рутина `_.routine.options` окрім встановлення значень опцій виконує перевірку вхідних даних: перевіряє, що `mapToStr` є рутиною і у неї наявна мапа дефолтних значень `mapToStr.defaults`. А також перевіряє, що мапа опцій `o` є об'єктом і не містить `undefined` значень. Також, `_.routine.options` може приймати масив аргументів замість мапи опцій.

```javascript
_.routine.options( mapToStr, arguments )
```

При помилці, повідомлення помилки відображає конкретну причину ( невідома опція, відсутність мапи дефолтних значень і тд ).

<!-- qqq : в кожній секції бракує прикладів викликів! -->
**Приклад виклику:**

Виклик офікованої рутини (підставляються дефолтні значення ```keyValDelimeter``` і ```entryDelimeter```)

```javascript
mapToStr({ src : { a : 1, b : 2, c : 3 } }); // log : a:1;b:2;c:3
```