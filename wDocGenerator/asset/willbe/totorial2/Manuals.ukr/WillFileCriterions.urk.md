# Критеріони (criterion) в `will`-файлах

В керівництві користувача визначено поняття критеріонів та приведено приклади їх використання при створенні модулів

Зміст керівництва
[Поняття критеріону](#criterion-term)
[Вимоги до використання](#terms-of-use)
[Приклад використання](#example)
[Вбудовані критеріони](#predefined-criterions)

### <a name="criterion-term"></a>  Поняття критеріону
Критеріон - логічний (булевий) елемент пакету `willbe` для побудови таблиці істинності використання обраного ресурсу. Критеріони приймають значення "0" та "1".

Приклад побудови таблиці істинності. Пакет `willbe` повинен після процедури відладки (`debug`), вивести в консолі фразу _'Debug is done'_, а якщо `debug` не виконується, виводити _'Operation is done'_.  Іншими словами, ми маємо один ключ-критеріон (`debug`) та дві дії - вивід фраз.
Таблиця істинності для цього випадку має вигляд:

| Виконання `debug` | Вивід 'Debug is done' | Вивід 'Operation is done'       |
|-------------------|-----------------------|---------------------------------|
| true              | 1                     | 0                               |
| falce             | 0                     | 1                               |

Приклад іллюструє бінарний вибір на основі одного критеріону, проте ресурс може мати довільне число критеріонів для правильного виконання процедур програми. Якщо число критеріонів збільшується, то структура таблиці ускладнюється.

### <a name="terms-of-use"></a> Вимоги до використання
Критеріони в `will`-файлі розташовуються в кожному ресурсі, який повинен обиратись згідно критеріону.  
Ресурс без критеріону приймає всі встановлені значення критеріону з яким порівнюється.  
Порівняння мап критеріонів проходить, коли здійснюється вибір по ґлобу. Якщо на ресурс використовується пряме посилання, то критеріони ігноруються.  

### <a name="example"></a> Приклад використання
Створимо `will`-файл:

<details>
  <summary><u>Лістинг файла `.will.yml`</u></summary>

```yaml

about :

    name : buildModuleWithCriterion
    description : "Output of various phrases using criterions"
    version : 0.0.1
    keywords :
        - willbe

step :

  echo :
    shell : echo "Debug is done"
    currentPath : '.'
    criterion :
       debug : 1

  echo.op :
    shell : echo "Operation is done"
    currentPath : '.'
    criterion :
       debug : 0

build :

  echo.debug:
    criterion :
       debug : 1
    steps :
       - echo*

  echo.op:
    criterion :
       debug : 0
    steps :
       - echo*

```

</details>

Дві збірки створено для зручності використання файла. Тепер в кореневій директорії файла запустіть побудову `will .build echo.debug`, а потім `will .build echo.op`:
```
...
Building echo.debug
 > echo "Debug is done"
Debug is done
  Built echo.debug in 0.062s

...
Building echo.op
 > echo "Operation is done"
Operation is done
  Built echo.op in 0.051s

```

Змінимо секцію `build` так, щоб збірка використовувала прямимі посилання:

```yaml

build :

  echo.debug:
    criterion :
       debug : 1
    steps :
       - echo
       - echo.op

```

Введемо фразу `will .build echo.debug`:
```
  Building echo.debug
 > echo "Debug is done"
Debug is done
 > echo "Operation is done"
Operation is done
  Built echo.debug in 0.132s

```
Як бачите, при прямому посиланні на ресурс критеріони ігноруються.

Змінимо секцію `step` `will`-файла залишивши:

```yaml
step :

  echo :
    shell : echo "Debug is done"
    currentPath : '.'

```
По черзі введемо `will .build echo.debug` і `will .build echo.op`:

```
...
Building echo.debug
> echo "Debug is done"
Debug is done
Built echo.debug in 0.368s

```

```
...
Building echo.op
> echo "Debug is done"
Debug is done
Built echo.op in 0.104s

```

Тепер при будь-якому значенні критеріону виконується крок `echo`. В секції `build` використовується посилання з ґлобом, проте відсутній критеріон приймає значення будь-якого встановленого.

### <a name="predefined-criterions"></a> Вбудовані критеріони  
В пакеті присутні вбудовані критеріони. Подібно до прапорців в консольних командах вони встановлюють поведінку побудови модуля.  
Критеріон `default` зі значенням "1" - встановлює збірку побудови модуля за замовчуванням, що дозволяє використовувати фрази побудови без аргументів - `will .build` і `will .export`. На збірки експорту (export) і побудови (build) може бути застосовано по одному критеріону `default`. Якщо критеріон в секції не вказаний, то за замовчуванням його значення "0".  
Критеріон `predefined` - вбудований критеріон пакету, автоматично встановлюється при використанні вбудованих функцій. Не встановлюється користувачем при побудові модуля, оскільки може викликати помилки.  
Критеріон `export` вважається звичайним критеріоном в системі, проте його використання має деякі особливості. Критеріон `export` зі значенням "1" дозволяє використовувати команду `.export`. Доступ до збірки здійснюється командою `will .export [scenario]`, де аргументом виступає назва збірки експорту. Якщо в `will`-файлі є єдина збірка за замовчуванням з критеріоном `export : 1`, то фраза `will .build` обов'язково повинна містити аргумент (або використовуйте `will .export`).   
Приклади застосування.
Збірка експорту модуля (`will .export [scenario]`)

```yaml

build :

  export:
    criterion :
       export : 1
    steps :
       - export.somthing*

```

Для створення збірки експорту модуля за замовчуванням (`will .export`):

```yaml

build :

  export:
    criterion :
       default : 1
       export : 1
    steps :
       - export.somthing*

```

Для створення збірки побудови модуля за замовчуванням (`will .build`):

```yaml

build :

  echo.debug:
    criterion :
       default : 1
    steps :
       - echo*

```

Об'єднання двох останніх збірок в одній не призведе до помилки, оскільки використовуються різні збірки побудови. Проте створення двох і більше збірок експорту або побудови (`build`) з критеріоном `default` викличе помилку при побудові модуля.

> Критеріони призначені для створення складних збірок побудови модуля. Притримуйтесь [простих правил](#terms-of-use) при їх використанні.  
> Використання [вбудованих критеріонів](#predefined-criterions) позначає головні збірки `will`-файла.

[Повернутись до змісту](../README.md#manuals)
